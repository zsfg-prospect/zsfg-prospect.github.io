(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{1058:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>y});var s=n(7876),a=n(7328),o=n.n(a),i=n(9099),r=n(4232);let l=e=>new TextDecoder("utf-8").decode(new TextEncoder().encode(e)).replace(/[\x00-\x1F\x7F-\x9F]/g," ").replace(/[ \t]{4,}/g,"\n\n").replace(/ +\n/g,"\n").trim();function c(e){var t;let{note:n,maxHeight:a=500,isHighlighted:o}=e,[i,c]=(0,r.useState)(!0),[d,m]=(0,r.useState)(!1),u=(0,r.useRef)(null),[h,x]=(0,r.useState)(null);return(0,r.useEffect)(()=>{if(u.current){let e=u.current.scrollHeight>a;m(e),c(!e)}},[a,n.text]),(0,r.useEffect)(()=>{if(h){let e=setTimeout(()=>{x(null)},3e3);return()=>clearTimeout(e)}},[h]),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6 transition-colors duration-500 ".concat(o?"bg-yellow-50":""),"data-note-id":n.note_id,children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:n.type}),(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:["(ID: ",n.note_id,")"]})]}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:n.clinical_service})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["Note Date: ",new Date(n.timestamp).toLocaleString()]}),d&&(0,s.jsx)("button",{onClick:()=>{i&&u.current&&(u.current.scrollTop=0),c(!i)},className:"text-blue-500 hover:text-blue-600 text-sm font-medium focus:outline-none whitespace-nowrap",children:i?"Show Less":"Show More"})]})]}),(0,s.jsxs)("div",{ref:u,className:"text-gray-600 relative ".concat(!d||i?"":"overflow-hidden"),style:{maxHeight:!d||i?void 0:"".concat(a,"px")},children:[(0,s.jsx)("p",{className:"whitespace-pre-wrap",children:(t=l(n.text),h?t.split(RegExp("(".concat(h,")"),"gi")).map((e,t)=>e.toLowerCase()===(null==h?void 0:h.toLowerCase())?(0,s.jsx)("span",{className:"bg-yellow-200 transition-colors duration-500",children:e},t):e):t)}),!i&&d&&(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-t from-white to-transparent"})]})]})})}let d={has_connections:{interpersonal_partner_violence:{answer:!1,explanation:"No history of IPV reported",noteReference:{noteId:"100",noteTimestamp:"2023-10-31 10:16:00",noteText:"Social Service Discharge Note Situation: Jane Doe is admitted due to No admission diagnoses are documented for this encounter...",relevantSnippet:"Pt is alert and oriented, cooperative with the medical team. No signs of interpersonal violence noted in assessment."}},tobacco_use:{answer:!0,explanation:"Current smoker, documented in substance use screening",noteReference:{noteId:"5",noteTimestamp:"2022-05-10 10:16:00",noteText:"Substance Use Brief Screen (SUBS) Instructions: Please check 1 box for each question...",relevantSnippet:"Tobacco? [x] [] - Result of screen is: Positive - Care Plan initiated and Physician notified."}},food_insecurity:{answer:!0,explanation:"Reports difficulty affording groceries",noteReference:{noteId:"2",noteTimestamp:"2022-05-02 10:16:00",noteText:"Semi-Annual Assessment Jane D. Smith was admitted...",relevantSnippet:"She has chronic pain and is opiate dependent. She has gained weight. She has a sweet tooth and usually has candy."}},substance_use:{answer:!0,explanation:"Current cannabis use documented",noteReference:{noteId:"2",noteTimestamp:"2022-05-02 10:16:00",noteText:"Semi-Annual Assessment Jane D. Smith was admitted...",relevantSnippet:"She has returned to smoking cannabis."}},alcohol_use:{answer:!0,explanation:"History of alcoholism, currently abstinent",noteReference:{noteId:"2",noteTimestamp:"2022-05-02 10:16:00",noteText:"Semi-Annual Assessment Jane D. Smith was admitted...",relevantSnippet:"Current Diagnoses: Advanced COPD, diabetes, hypertension, alcoholism. She has not had a drink since 2020."}},depression:{answer:!0,explanation:"Shows signs of emotional distress",noteReference:{noteId:"2",noteTimestamp:"2022-05-02 10:16:00",noteText:"Semi-Annual Assessment Jane D. Smith was admitted...",relevantSnippet:"She sometimes gets teary when talking about her spouse. She can be very irritable at times."}},transportation_needs:{answer:!0,explanation:"Needs assistance with transportation to appointments",noteReference:{noteId:"100",noteTimestamp:"2023-10-31 10:16:00",noteText:"Social Service Discharge Note...",relevantSnippet:"Assessment: Pt expresses concern about mobility issues. Family members are supportive but also express concerns about pt's safety."}},employment:{answer:!1,explanation:"Currently in long-term care facility",noteReference:{noteId:"2",noteTimestamp:"2022-05-02 10:16:00",noteText:"Semi-Annual Assessment Jane D. Smith was admitted...",relevantSnippet:"Discharge Potential: Resident will remain at LHH due to care needs. Discharge Potential/Projected Length of Stay: Poor and Long Term"}},housing:{answer:!0,explanation:"Currently experiencing housing instability, residing in care facility",noteReference:{noteId:"4",noteTimestamp:"2022-05-11 10:16:00",noteText:"RCT met and reviewed resident's discharge potential...",relevantSnippet:"She was unable to manage in RCFI due to high care needs. An attempt was made for her to return to her previous residence, but she did not pass the home evaluation."}}},connected_service:{interpersonal_partner_violence:{answer:"NA",explanation:"No services needed"},tobacco_use:{answer:"Smoking cessation program",explanation:"Enrolled in weekly counseling",noteReference:{noteId:"5",noteTimestamp:"2022-05-10 10:16:00",noteText:"Substance Use Brief Screen (SUBS)...",relevantSnippet:"Positive for tobacco - Care Plan initiated and Physician notified."}},food_insecurity:{answer:"Food bank referral",explanation:"Connected to local food bank"},substance_use:{answer:"NA",explanation:"No services needed",noteReference:{noteId:"2",noteTimestamp:"2022-05-02 10:16:00",noteText:"Semi-Annual Assessment...",relevantSnippet:"She has returned to smoking cannabis. MSW will continue to meet for 1:1 support and advocacy."}},alcohol_use:{answer:"NA",explanation:"No intervention required"},depression:{answer:"Mental health services",explanation:"Regular therapy sessions",noteReference:{noteId:"2",noteTimestamp:"2022-05-02 10:16:00",noteText:"Semi-Annual Assessment...",relevantSnippet:"MSW will continue to meet for 1:1 support and advocacy."}},transportation_needs:{answer:"Medical transportation service",explanation:"Enrolled in medical transport program",noteReference:{noteId:"100",noteTimestamp:"2023-10-31 10:16:00",noteText:"Social Service Discharge Note...",relevantSnippet:"Coordination with skilled nursing facility for bed availability and transfer. Home health services setup post-rehabilitation."}},employment:{answer:"NA",explanation:"No services needed"},housing:{answer:"Housing assistance program",explanation:"Working with housing coordinator",noteReference:{noteId:"4",noteTimestamp:"2022-05-11 10:16:00",noteText:"RCT met and reviewed resident's discharge potential...",relevantSnippet:"Resident is suitable for SNF level care. She requires maximum assistance with ADL's."}}},barriers_to_service:{interpersonal_partner_violence:{answer:"NA",explanation:"No barriers identified"},tobacco_use:{answer:"Cost of nicotine replacement",explanation:"Insurance coverage pending",noteReference:{noteId:"5",noteTimestamp:"2022-05-10 10:16:00",noteText:"Substance Use Brief Screen (SUBS)...",relevantSnippet:"Positive for tobacco - Care Plan initiated and Physician notified."}},food_insecurity:{answer:"Transportation to food bank",explanation:"Difficulty accessing location",noteReference:{noteId:"2",noteTimestamp:"2022-05-02 10:16:00",noteText:"Semi-Annual Assessment...",relevantSnippet:"She uses a power chair both on and off the unit."}},substance_use:{answer:"NA",explanation:"No barriers identified"},alcohol_use:{answer:"NA",explanation:"No barriers identified"},depression:{answer:"Schedule conflicts",explanation:"Work schedule limits availability",noteReference:{noteId:"2",noteTimestamp:"2022-05-02 10:16:00",noteText:"Semi-Annual Assessment...",relevantSnippet:"She sometimes gets teary when talking about her spouse. She sometimes panics about her breathing."}},transportation_needs:{answer:"Service availability",explanation:"Limited weekend service",noteReference:{noteId:"100",noteTimestamp:"2023-10-31 10:16:00",noteText:"Social Service Discharge Note...",relevantSnippet:"Family members are supportive but also express concerns about pt's safety."}},employment:{answer:"NA",explanation:"No barriers identified"},housing:{answer:"Long waitlist",explanation:"Currently on waiting list for housing",noteReference:{noteId:"4",noteTimestamp:"2022-05-11 10:16:00",noteText:"RCT met and reviewed resident's discharge potential...",relevantSnippet:"She was unable to manage in RCFI due to high care needs. An attempt was made for her to return to her previous residence, but she did not pass the home evaluation."}}}},m=[{id:"P001",name:"Jane D. Smith",summary:d},{id:"P002",name:"Jane Smith",summary:d}],u=()=>{let e=(0,i.useRouter)();return(0,s.jsxs)("div",{className:"w-64 min-h-screen bg-gradient-to-b from-blue-600 to-blue-700 shadow-lg",children:[(0,s.jsx)("button",{onClick:()=>e.push("/"),className:"w-full p-4 border-b border-blue-500 text-left hover:bg-blue-500/20 transition-colors",children:(0,s.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Patient Records"})}),(0,s.jsx)("nav",{className:"p-4",children:(0,s.jsx)("ul",{className:"space-y-2",children:m.map(t=>(0,s.jsx)("li",{children:(0,s.jsxs)("button",{onClick:()=>e.push("/patient/".concat(t.id)),className:"w-full text-left px-4 py-3 rounded bg-white/10 hover:bg-white/20 transition-all transform hover:scale-[1.02]",children:[(0,s.jsx)("div",{className:"font-medium text-white",children:t.name}),(0,s.jsxs)("div",{className:"text-sm text-blue-100",children:["ID: ",t.id]})]})},t.id))})})]})};function h(e){let{children:t,showSidebar:n=!1}=e;return(0,s.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,s.jsxs)("div",{className:"flex",children:[n&&(0,s.jsx)(u,{}),(0,s.jsx)("main",{className:"min-h-screen ".concat(n?"flex-1 p-8":"w-full"),children:t})]})})}let x=()=>(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-100 bg-opacity-75 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("h2",{className:"mt-4 text-xl font-semibold text-gray-700",children:"Generating Summary..."}),(0,s.jsx)("p",{className:"mt-2 text-gray-500",children:"Please wait while we analyze the patient notes."})]})}),p=()=>{document.querySelectorAll(".bg-yellow-200").forEach(e=>{if(e instanceof HTMLElement){let t=e.parentNode;t&&(t.textContent=t.textContent)}})},g=e=>{let{actions:t,title:n,sectionId:a,onNoteClick:o}=e,i=(0,r.useCallback)((e,t)=>{o&&o(e,a),console.log("Attempting to find note with ID: ".concat(e)),p();let n=document.querySelector('[data-note-id="'.concat(e,'"]'));if(n){var s,i;console.log("Found note element");let e=n.querySelector("button");e&&(null===(s=e.textContent)||void 0===s?void 0:s.includes("Show More"))&&(console.log("Found Show More button, expanding note"),e.click());let a=n.querySelector(".whitespace-pre-wrap");if(a){console.log("Found text content element, attempting to highlight text");let e=document.createElement("div");e.innerHTML=t;let s=(null===(i=e.textContent)||void 0===i?void 0:i.toLowerCase())||"",o=a.textContent||"",r=o.toLowerCase(),l=[],c=0;for(;;){let e=r.indexOf(s,c);if(-1===e)break;l.push(e),c=e+s.length}if(l.length>0){console.log("Found ".concat(l.length," matches, highlighting all and scrolling to first match"));let e=0,t="";l.forEach(n=>{t+=o.slice(e,n);let a=o.slice(n,n+s.length);t+='<span class="bg-yellow-200 transition-colors duration-500">'.concat(a,"</span>"),e=n+s.length}),a.innerHTML=t+=o.slice(e),n.scrollIntoView({behavior:"smooth",block:"center"})}else{console.warn("Text not found in note content"),console.warn("Searching for text:",s),console.warn("In content:",o);let e=document.createElement("div");e.className="bg-yellow-100 text-yellow-800 p-4 rounded-lg mb-4 flex justify-between items-center";let t=document.createElement("div");t.textContent="Unable to find the exact text cited in this note. The text might be paraphrased or appear in a different format.",e.appendChild(t);let a=document.createElement("button");a.innerHTML='\n                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />\n                        </svg>\n                    ',a.className="text-yellow-800 hover:text-yellow-900 focus:outline-none ml-4",a.onclick=()=>{e.style.opacity="0",setTimeout(()=>e.remove(),500)},e.appendChild(a),n.querySelectorAll(".bg-yellow-100").forEach(e=>e.remove()),n.insertBefore(e,n.firstChild),setTimeout(()=>{let e=n.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/3;window.scrollTo({top:e,behavior:"smooth"})},100)}}else console.warn("Text content element not found")}else console.warn("Note with ID ".concat(e," not found in the DOM")),console.log("Available note IDs:",Array.from(document.querySelectorAll("[data-note-id]")).map(e=>e.getAttribute("data-note-id")))},[o,a]);return 0===t.length?null:(0,s.jsxs)("div",{className:"space-y-2 pl-4 border-l-2 border-gray-100","data-section-id":a,children:[(0,s.jsxs)("h4",{className:"font-medium text-gray-700 flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-gray-400"}),n]}),(0,s.jsx)("div",{className:"space-y-3",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg hover:bg-gray-100 transition-colors duration-200",children:[(0,s.jsx)("p",{className:"text-gray-700 mb-2 text-sm",children:e.description}),(0,s.jsxs)("blockquote",{className:"border-l-4 border-blue-500 pl-4 italic cursor-pointer bg-white rounded-r-lg transition-all duration-200 hover:shadow-md",onClick:()=>i(e.citation.note_id,e.citation.quote),children:[(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["“",e.citation.quote,"”"]}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[(0,s.jsx)("span",{className:"font-medium",children:"Source:"})," Note ",e.citation.note_id]})]})]},t))})]})},f=e=>{let{needs:t,activeNeedId:n,onNeedClick:a}=e,[o,i]=(0,r.useState)({summary:!0,notes:!0}),l=e=>{i(t=>({...t,[e]:!t[e]}))},c=e=>{let t=document.querySelector("#".concat(e));t&&t.scrollIntoView({behavior:"smooth",block:"start"})};return(0,s.jsxs)("nav",{className:"sticky top-4 bg-white rounded-lg shadow-md p-4 mb-6 max-h-[calc(100vh-2rem)] overflow-y-auto",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-4",children:"Navigation"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"border-b pb-2",children:[(0,s.jsxs)("button",{onClick:()=>l("summary"),className:"w-full flex items-center justify-between text-left px-2 py-1 rounded-md hover:bg-gray-50 transition-colors duration-200",children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:"Generated Summary"}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-500 transition-transform duration-200 ".concat(o.summary?"transform rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o.summary&&(0,s.jsx)("div",{className:"mt-2 pl-4 space-y-2",children:t.map((e,t)=>(0,s.jsx)("button",{onClick:()=>a("need-".concat(t)),className:"w-full text-left px-3 py-2 rounded-md text-sm transition-colors duration-200\n                                        ".concat(n==="need-".concat(t)?"bg-blue-50 text-blue-700 font-medium":"text-gray-600 hover:bg-gray-50"),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-5 h-5 flex-shrink-0 rounded-full bg-blue-100 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-xs text-blue-600 font-medium",children:t+1})}),(0,s.jsx)("span",{className:"truncate",children:e.description})]})},t))})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("button",{onClick:()=>{l("notes"),c("patient-notes")},className:"w-full flex items-center justify-between text-left px-2 py-1 rounded-md hover:bg-gray-50 transition-colors duration-200",children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:"Patient Notes"}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-500 transition-transform duration-200 ".concat(o.notes?"transform rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})})]})]})},v=e=>{let{need:t,index:n,onNoteClick:a,isExpanded:o,onToggleExpand:i}=e,l="need-".concat(n),c=t.current_actions.length>0,d=t.planned_actions.length>0,m=c?"active":d?"pending":"completed",u=(0,r.useCallback)((e,t)=>{a&&a(e,l),p();let n=document.querySelector('[data-note-id="'.concat(e,'"]'));if(n){let e=n.querySelector(".whitespace-pre-wrap");if(e){let n=e.textContent||"",s=n.indexOf(t);-1!==s&&(e.innerHTML="".concat(n.slice(0,s),'<span class="bg-yellow-200 transition-colors duration-500">').concat(t,"</span>").concat(n.slice(s+t.length)))}}},[a,l]);return(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-md overflow-hidden","data-section-id":l,children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-white p-6 border-b cursor-pointer transition-colors duration-200 ".concat(o?"":"hover:bg-blue-50"),onClick:i,children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-blue-600 font-semibold",children:n+1})}),(0,s.jsxs)("div",{className:"flex-grow",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:t.description}),(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat({active:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",completed:"bg-gray-100 text-gray-800"}[m]),children:{active:"Active",pending:"Pending",completed:"Completed"}[m]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[t.previous_actions.length>0&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),t.previous_actions.length," Previous"]}),t.current_actions.length>0&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),t.current_actions.length," Current"]}),t.planned_actions.length>0&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),t.planned_actions.length," Planned"]})]})]}),(0,s.jsx)("button",{className:"ml-4 text-gray-400 hover:text-gray-600 focus:outline-none transition-transform duration-200",style:{transform:o?"rotate(180deg)":"rotate(0deg)"},onClick:e=>{e.stopPropagation(),i()},children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,s.jsx)("div",{className:"transition-all duration-300 ".concat(o?"opacity-100":"opacity-0 h-0 overflow-hidden"),children:(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow duration-200",children:(0,s.jsxs)("blockquote",{className:"border-l-4 border-blue-500 pl-4 italic cursor-pointer",onClick:e=>{e.stopPropagation(),u(t.citation.note_id,t.citation.quote)},children:[(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["“",t.citation.quote,"”"]}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[(0,s.jsx)("span",{className:"font-medium",children:"Source:"})," Note ",t.citation.note_id]})]})})})]})]})}),(0,s.jsx)("div",{className:"transition-all duration-300 ".concat(o?"opacity-100":"opacity-0 h-0 overflow-hidden"),children:(0,s.jsx)("div",{className:"p-6 space-y-6",children:(0,s.jsxs)("div",{className:"relative space-y-6",children:[t.previous_actions.length>0&&(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(g,{title:"Previous Actions",actions:t.previous_actions,sectionId:"".concat(l,"-previous"),onNoteClick:a})}),t.current_actions.length>0&&(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(g,{title:"Current Actions",actions:t.current_actions,sectionId:"".concat(l,"-current"),onNoteClick:a})}),t.planned_actions.length>0&&(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(g,{title:"Planned Actions",actions:t.planned_actions,sectionId:"".concat(l,"-planned"),onNoteClick:a})}),t.relevant_resources&&t.relevant_resources.length>0&&(0,s.jsxs)("div",{className:"relative mt-6",children:[(0,s.jsxs)("h4",{className:"font-medium text-gray-700 flex items-center gap-2 mb-4 pl-4 border-l-2 border-gray-100",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-gray-400"}),"Relevant Resources"]}),(0,s.jsx)("div",{className:"space-y-3 pl-4 border-l-2 border-gray-100",children:t.relevant_resources.map((e,t)=>(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg hover:bg-gray-100 transition-colors duration-200",children:[(0,s.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 font-medium mb-1 block",children:e.name}),(0,s.jsx)("p",{className:"text-gray-600 text-sm mb-2",children:e.category}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tags&&e.tags.map((e,t)=>(0,s.jsx)("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 text-xs rounded-full",children:e},t))})]},t))})]})]})})})]})};function b(e){let{summary:t,onNoteClick:n,summaryRef:a}=e,[o,i]=(0,r.useState)(null),[l,c]=(0,r.useState)({}),[d,m]=(0,r.useState)(!1);(0,r.useEffect)(()=>{c(t.identified_needs.reduce((e,t,n)=>(e[n]=!1,e),{}))},[t.identified_needs]);let u=e=>{c(t=>({...t,[e]:!t[e]})),m(Object.values({...l,[e]:!l[e]}).every(e=>e))};return((0,r.useEffect)(()=>{let e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&i(e.target.getAttribute("data-section-id"))})},{threshold:.5});return document.querySelectorAll('[data-section-id^="need-"]').forEach(t=>e.observe(t)),()=>e.disconnect()},[t]),t.identified_needs.length)?(0,s.jsxs)("div",{className:"flex gap-6",children:[(0,s.jsx)("div",{className:"w-1/4",children:(0,s.jsx)(f,{needs:t.identified_needs,activeNeedId:o,onNeedClick:e=>{let t=document.querySelector('[data-section-id="'.concat(e,'"]'));t&&t.scrollIntoView({behavior:"smooth",block:"start"})}})}),(0,s.jsx)("div",{className:"flex-1 space-y-8",children:(0,s.jsxs)("div",{id:"generated-summary",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Generated Summary"}),(0,s.jsxs)("button",{onClick:()=>{let e=!d;m(e),c(Object.keys(l).reduce((t,n)=>(t[Number(n)]=e,t),{}))},className:"inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200",children:[(0,s.jsx)("svg",{className:"w-5 h-5 mr-2 transition-transform duration-200 ".concat(d?"transform rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),d?"Collapse All":"Expand All"]})]}),t.identified_needs.map((e,t)=>(0,s.jsx)(v,{need:e,index:t,onNoteClick:n,isExpanded:l[t]||!1,onToggleExpand:()=>u(t)},t))]})})]}):(0,s.jsx)("div",{className:"bg-yellow-50 border border-yellow-400 text-yellow-700 px-4 py-3 rounded",children:"No needs identified in the provided notes."})}let w=e=>{let{socialRiskData:t,onNoteClick:n,isExpanded:a,onToggleExpand:o}=e,i=(e,t)=>{n&&n(e,"social-risk"),document.querySelectorAll(".bg-yellow-200").forEach(e=>{if(e instanceof HTMLElement){let t=e.parentNode;t&&(t.textContent=t.textContent)}});let s=document.querySelector('[data-note-id="'.concat(e,'"]'));if(s){let e=s.querySelector(".whitespace-pre-wrap");if(e){let n=e.textContent||"",s=n.indexOf(t);-1!==s&&(e.innerHTML="".concat(n.slice(0,s),'<span class="bg-yellow-200 transition-colors duration-500">').concat(t,"</span>").concat(n.slice(s+t.length)))}}};return(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-md overflow-hidden","data-section-id":"social-risk",children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-white p-6 border-b cursor-pointer transition-colors duration-200 ".concat(a?"":"hover:bg-purple-50"),onClick:o,children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),(0,s.jsx)("div",{className:"flex-grow",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Social Risk Informed Care"}),(0,s.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:"Social Risk"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:t.description})]}),(0,s.jsx)("button",{className:"ml-4 text-gray-400 hover:text-gray-600 focus:outline-none transition-transform duration-200",style:{transform:a?"rotate(180deg)":"rotate(0deg)"},onClick:e=>{e.stopPropagation(),o()},children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})})]})}),(0,s.jsx)("div",{className:"transition-all duration-300 ".concat(a?"opacity-100":"opacity-0 h-0 overflow-hidden"),children:(0,s.jsx)("div",{className:"p-6 space-y-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900",children:"Recommendations"}),t.recommendations.map((e,t)=>(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg hover:bg-gray-100 transition-colors duration-200",children:[(0,s.jsx)("p",{className:"text-gray-700 mb-2 text-sm",children:e.description}),e.citation&&(0,s.jsxs)("blockquote",{className:"border-l-4 border-purple-500 pl-4 italic cursor-pointer bg-white rounded-r-lg transition-all duration-200 hover:shadow-md",onClick:()=>i(e.citation.note_id,e.citation.quote),children:[(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["“",e.citation.quote,"”"]}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[(0,s.jsx)("span",{className:"font-medium",children:"Source:"})," Note ",e.citation.note_id]})]})]},t))]})})})]})};function y(){let e=(0,i.useRouter)(),{id:t,timestamps:a}=e.query,[l,d]=(0,r.useState)(!0),[m,u]=(0,r.useState)(null),[p,g]=(0,r.useState)(null),[f,v]=(0,r.useState)([]),[y,j]=(0,r.useState)(null),[N,S]=(0,r.useState)(null),[k,C]=(0,r.useState)(!1),T=(0,r.useRef)(null),_=(0,r.useRef)(null),[R,A]=(0,r.useState)(null),[L,I]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=()=>{T.current&&C(T.current.getBoundingClientRect().bottom<0)};return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[]),(0,r.useEffect)(()=>{t&&a&&(async()=>{d(!0);try{let e=(Array.isArray(a)?a:[a])[0];console.log("Fetching data with timestamp:",e);let{getPatientNotes:s,getPatientSummary:o,getPatientSocialRisk:i}=await n.e(944).then(n.bind(n,944)),r=parseInt(t,10);console.log("Fetching notes...");let l=await s(r,[e]);console.log("Notes fetched successfully:",l.notes.length,"notes");let c=l.notes.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime());v(c),console.log("Fetching summary...");let d=await o(r,[e]);console.log("Summary fetched successfully:",d),u(d.summary),console.log("Fetching summary...");let m=await i(r,[e]);console.log("Social Risk data fetched successfully:",m),g(m)}catch(e){console.error("Error fetching data:",e),j(e instanceof Error?e.message:"An error occurred")}finally{d(!1)}})()},[t,a]);let E=(e,t)=>{S(e),A(t||null);let n=document.querySelector('[data-note-id="'.concat(e,'"]'));n&&n.scrollIntoView({behavior:"smooth",block:"center"})};return l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o(),{children:(0,s.jsx)("title",{children:"Loading... | Social Services Note Viewer"})}),(0,s.jsx)(x,{})]}):y?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o(),{children:(0,s.jsx)("title",{children:"Error | Social Services Note Viewer"})}),(0,s.jsx)(h,{showSidebar:!1,children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto p-4",children:(0,s.jsxs)("div",{className:"bg-red-50 border border-red-400 text-red-700 px-4 py-3 rounded",children:[(0,s.jsx)("p",{children:y}),(0,s.jsx)("button",{onClick:()=>e.push("/"),className:"mt-2 text-sm font-medium text-red-600 hover:text-red-500",children:"Return to Home"})]})})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o(),{children:[(0,s.jsxs)("title",{children:["Patient ",t," Summary | Social Services Note Viewer"]}),(0,s.jsx)("meta",{name:"description",content:"View and analyze social services notes and summaries"})]}),(0,s.jsx)(h,{showSidebar:!1,children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold text-gray-900",children:["Patient ",t," Summary"]}),(0,s.jsxs)("button",{onClick:()=>e.push("/"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200 flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L4.414 9H17a1 1 0 110 2H4.414l5.293 5.293a1 1 0 010 1.414z",clipRule:"evenodd"})}),"Return to Home"]})]}),(0,s.jsxs)("div",{className:"flex flex-col space-y-12",children:[(0,s.jsx)("section",{id:"generated-summary",className:"scroll-mt-4",children:m?(0,s.jsx)("div",{ref:T,children:(0,s.jsx)(b,{summary:m,onNoteClick:E,summaryRef:T})}):(0,s.jsx)("div",{className:"bg-yellow-50 border border-yellow-400 text-yellow-700 px-4 py-3 rounded",children:"No summary available"})}),(0,s.jsx)("section",{id:"generated-social-risks",className:"scroll-mt-4",children:p?(0,s.jsx)("div",{ref:_,className:"mt-8",children:(0,s.jsx)(w,{socialRiskData:p,onNoteClick:E,isExpanded:L,onToggleExpand:()=>I(e=>!e)})}):(0,s.jsx)("div",{className:"bg-yellow-50 border border-yellow-400 text-yellow-700 px-4 py-3 rounded",children:"No social risks available"})}),(0,s.jsxs)("section",{id:"patient-notes",className:"scroll-mt-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Patient Notes"}),(0,s.jsx)("div",{className:"space-y-6",children:f.map(e=>(0,s.jsx)(c,{note:e,isHighlighted:N===e.note_id},e.timestamp))})]})]}),k&&(0,s.jsxs)("button",{onClick:()=>{var e,t;R?(null===(e=T.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{let e=document.querySelector('[data-section-id="'.concat(R,'"]'));e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("bg-blue-50"),setTimeout(()=>{e.classList.remove("bg-blue-50")},2e3))},100)):null===(t=T.current)||void 0===t||t.scrollIntoView({behavior:"smooth",block:"start"})},className:"fixed bottom-6 right-6 bg-blue-600 text-white px-4 py-2 rounded-full shadow-lg hover:bg-blue-700 transition-colors duration-200 flex items-center space-x-2 z-50 group","aria-label":"Back to summary",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z",clipRule:"evenodd"})}),(0,s.jsxs)("span",{children:["Back to"," ",(0,s.jsx)("span",{className:"font-medium",children:R?"Last Section":"Summary"})]})]})]})})]})}},4330:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/patient/[id]",function(){return n(1058)}])},7328:(e,t,n)=>{e.exports=n(9836)},9099:(e,t,n)=>{e.exports=n(8253)}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(4330)),_N_E=e.O()}]);